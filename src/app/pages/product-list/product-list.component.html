<div class="product-list-page">
  <!-- Breadcrumb -->
  <div class="breadcrumb-section">
    <div class="container">
      <nav class="breadcrumb">
        <a routerLink="/">Home</a> / 
        <ng-container *ngIf="!categoryName || categoryName === 'All Products' || categoryName === 'Shop'">
          <span>Shop</span>
        </ng-container>
        <ng-container *ngIf="categoryName && categoryName !== 'All Products' && categoryName !== 'Shop'">
          <ng-container *ngIf="categoryName.includes('/')">
            <a routerLink="/category/raspberry">Raspberry Pi Boards</a> / 
            <span>RPI Accessories</span>
          </ng-container>
          <ng-container *ngIf="!categoryName.includes('/')">
            <span>{{ categoryName }}</span>
          </ng-container>
        </ng-container>
      </nav>
    </div>
  </div>

  <!-- Categories Grid View (shown on /shop) -->
  <div *ngIf="showCategories" class="categories-view">
    <div class="category-header">
      <div class="container">
        <h1 class="category-title">Shop by Category</h1>
        <p class="product-count">Browse all {{ categories.length }} product categories</p>
      </div>
    </div>

    <div class="container">
      <div class="categories-grid">
        <a *ngFor="let category of categories; trackBy: trackByCategoryId" 
           [routerLink]="['/category', category.slug]" 
           class="category-card">
          <div class="category-image">
            <img [src]="category.image" 
                 [alt]="category.name"
                 onerror="this.src='assets/images/placeholder.jpg'">
          </div>
          <div class="category-info">
            <h3>{{ category.name }}</h3>
            <p>{{ category.productCount }} products</p>
          </div>
        </a>
      </div>
    </div>

    <!-- Show brand products with categories when brand filter is active -->
    <div *ngIf="brandFilter && filteredProducts.length > 0" class="container" style="margin-top: 40px;">
      <!-- Brand Header -->
      <div style="margin-bottom: 40px; border-bottom: 2px solid #007bff; padding-bottom: 20px;">
        <h2 style="font-size: 28px; margin-bottom: 10px;">{{ brandDisplayName }} PRODUCTS</h2>
        <p style="color: #666; font-size: 14px;">Total: {{ filteredProducts.length }} products</p>
      </div>

      <!-- Categories for this brand -->
      <div *ngIf="categoriesForBrand.length > 0" style="margin-bottom: 40px;">
        <h3 style="font-size: 18px; margin-bottom: 20px; font-weight: 600;">CATEGORIES</h3>
        <div class="subcategories-grid">
          <div *ngFor="let cat of categoriesForBrand" 
               [routerLink]="['/category', cat.slug]"
               style="cursor: pointer;"
               class="subcategory-card">
            <div class="subcategory-image">
              <img [src]="cat.image || 'assets/images/placeholder.jpg'" 
                   [alt]="cat.name"
                   onerror="this.src='assets/images/placeholder.jpg'">
            </div>
            <div class="subcategory-info">
              <h3>{{ cat.name }}</h3>
              <p>{{ getProductCountForCategory(cat.name) }} products</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Products with Sorting -->
      <div style="margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; gap: 20px; flex-wrap: wrap;">
        <h3 style="font-size: 18px; font-weight: 600;">PRODUCTS</h3>
        <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
          <!-- Search Bar -->
          <div style="display: flex; align-items: center;">
            <input type="text" 
                   [(ngModel)]="searchTerm"
                   (ngModelChange)="onSearchChange(searchTerm)"
                   placeholder="Search products..." 
                   style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px 0 0 4px; width: 200px; font-size: 14px;">
            <i class="fas fa-search" style="padding: 8px 12px; background: #f8f9fa; border: 1px solid #ddd; border-left: none; border-radius: 0 4px 4px 0; color: #666;"></i>
          </div>

          <!-- Sort By -->
          <div style="display: flex; gap: 10px; align-items: center;">
            <label for="sort" style="font-weight: 500; white-space: nowrap;">Sort By:</label>
            <select id="sort" 
                    [value]="sortBy" 
                    (change)="onSortChange($event)"
                    style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px;">
              <option value="default">Default</option>
              <option value="price-low">Price: Low to High</option>
              <option value="price-high">Price: High to Low</option>
              <option value="name">Name (A-Z)</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Products Grid -->
      <div class="product-grid">
        <app-product-card 
          *ngFor="let product of displayedProducts; trackBy: trackByProductId" 
          [product]="product"
          (loginRequired)="onLoginRequired($event)">
        </app-product-card>
      </div>

      <!-- Pagination Component -->
      <app-pagination 
        *ngIf="paginationState && paginationState.totalPages > 1"
        [paginationState]="paginationState" 
        [pageNumbers]="pageNumbers"
        (pageChanged)="onPageChanged($event)">
      </app-pagination>
    </div>
  </div>

  <!-- Products View (shown when category or brand filter is active) -->
  <div *ngIf="!showCategories">
  <!-- Category Header -->
  <div class="category-header">
    <div class="container">
      <h1 class="category-title">{{ getCategoryDisplayName() }}</h1>
      <p class="product-count">Showing {{ filteredProducts.length}} products</p>
    </div>
  </div>

  <!-- Product Tiles (show products as large image cards like categories) -->
  <div *ngIf="!showCategories && displayedProducts.length > 0" class="product-tiles">
    <div class="container">
      <div class="categories-grid product-tiles-grid">
        <a *ngFor="let product of displayedProducts; trackBy: trackByProductId" 
           [routerLink]="['/product', product.id]" 
           class="category-card product-tile-card">
          <div class="category-image">
            <img [src]="product.image || 'assets/images/placeholder.jpg'" 
                 [alt]="product.name" 
                 onerror="this.src='assets/images/placeholder.jpg'">
          </div>
          <div class="category-info">
            <h3>{{ product.name }}</h3>
            <p>₹{{ product.price }}</p>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Subcategories -->
  <div class="subcategories-section" *ngIf="currentCategory && currentCategory.subcategories && currentCategory.subcategories.length > 0">
    <div class="container">
      <div class="subcategories-grid">
        <a *ngFor="let subcat of currentCategory.subcategories" 
           [routerLink]="['/category', currentCategory.slug + '/' + subcat.slug]" 
           class="subcategory-card">
          <div class="subcategory-image">
            <img [src]="subcat.image || 'assets/images/placeholder.jpg'" 
                 [alt]="subcat.name"
                 onerror="this.src='assets/images/placeholder.jpg'">
          </div>
          <div class="subcategory-info">
            <h3>{{ subcat.name }}</h3>
            <p>{{ subcat.productCount }} products</p>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Category Description -->
  <div class="category-description" *ngIf="categoryDescription">
    <div class="container">
      <p>{{ categoryDescription }}</p>
    </div>
  </div>

  <div class="container">
    <div class="products-container">
      <div class="filters-sidebar">
        <div class="filter-section">
          <h3>Categories</h3>
          <ul class="filter-list">
            <li><a routerLink="/shop">All Products</a></li>
            <li><a routerLink="/category/robotic-diy-kits">Robotic DIY Kits</a></li>
            <li><a routerLink="/category/ready-running-projects">Ready Running Projects</a></li>
            <li><a routerLink="/category/raspberry">Raspberry Pi</a></li>
            <li style="padding-left: 15px;"><a routerLink="/category/raspberry/rpi-accessories">- RPI Accessories</a></li>
            <li><a routerLink="/category/mini-drone-kits">Mini Drone Kits</a></li>
            <li><a routerLink="/category/diy-kits">DIY Kits</a></li>
            <li><a routerLink="/category/bonka">Bonka Batteries</a></li>
          </ul>
        </div>

        <div class="filter-section">
          <h3>Price Range</h3>
          <ul class="filter-list">
            <li><a href="#">Under ₹1000</a></li>
            <li><a href="#">₹1000 - ₹3000</a></li>
            <li><a href="#">₹3000 - ₹5000</a></li>
            <li><a href="#">Above ₹5000</a></li>
          </ul>
        </div>

        <div class="filter-section">
          <h3>Brand</h3>
          <ul class="filter-list">
            <li><a href="#">ACEBOTT</a></li>
            <li><a href="#">Arduino</a></li>
            <li><a href="#">BONKA</a></li>
            <li><a href="#">Raspberry Pi</a></li>
            <li><a href="#">EMAX</a></li>
          </ul>
        </div>
      </div>

      <div class="products-main">
        <div class="products-toolbar">
          <div class="view-options">
            <button class="view-btn" [class.active]="showProductTiles" (click)="setView('tiles')"><i class="fas fa-th"></i></button>
            <button class="view-btn" [class.active]="!showProductTiles" (click)="setView('list')"><i class="fas fa-list"></i></button>
          </div>

          <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
            <!-- Search Bar -->
            <div style="display: flex; align-items: center;">
              <input type="text" 
                     [(ngModel)]="searchTerm"
                     (ngModelChange)="onSearchChange(searchTerm)"
                     placeholder="Search products..." 
                     style="padding: 8px 12px; border: 1px solid #ddd; border-radius: 4px 0 0 4px; width: 200px; font-size: 14px;">
              <i class="fas fa-search" style="padding: 8px 12px; background: #f8f9fa; border: 1px solid #ddd; border-left: none; border-radius: 0 4px 4px 0; color: #666;"></i>
            </div>

            <!-- Sort By -->
            <div class="sort-options">
              <label>Sort By:</label>
              <select (change)="onSortChange($event)" [value]="sortBy">
                <option value="default">Default</option>
                <option value="name">Name</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
              </select>
            </div>
          </div>
        </div>

        <div class="product-grid" *ngIf="displayedProducts.length > 0 && !showProductTiles">
          <app-product-card 
            *ngFor="let product of displayedProducts; trackBy: trackByProductId" 
            [product]="product"
            (loginRequired)="onLoginRequired($event)">
          </app-product-card>
        </div>

        <div class="no-products" *ngIf="filteredProducts.length === 0">
          <i class="fas fa-box-open"></i>
          <h3>No products found</h3>
          <p>Try adjusting your filters or search criteria</p>
        </div>

        <!-- Bottom Pagination -->
        <app-pagination 
          *ngIf="paginationState && paginationState.totalPages > 1"
          [paginationState]="paginationState" 
          [pageNumbers]="pageNumbers"
          (pageChanged)="onPageChanged($event)">
        </app-pagination>
      </div>
    </div>
  </div>
  </div>

<!-- Auth Modal -->
<app-auth-modal *ngIf="showAuthModal" [message]="authModalMessage" [initialTab]="authModalTab" (close)="closeAuthModal()"></app-auth-modal>
</div>
