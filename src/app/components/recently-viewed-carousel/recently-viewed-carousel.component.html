<section class="recently-viewed-section" *ngIf="!loading && recentlyViewedProducts.length > 0">
  <div class="container">
    <!-- Header -->
    <div class="section-header">
      <div class="title-wrapper">
        <h2 class="section-title">
          <i class="fas fa-history"></i> Recently Viewed
        </h2>
        <p class="subtitle">Products you've been looking at</p>
      </div>
      <button class="clear-btn" (click)="clearHistory()" title="Clear history">
        <i class="fas fa-trash-alt"></i>
      </button>
    </div>

    <!-- Carousel View -->
    <div *ngIf="variant === 'carousel'" class="carousel-wrapper">
      <button class="carousel-nav carousel-nav-prev" (click)="scrollCarousel('left')" aria-label="Previous">
        <i class="fas fa-chevron-left"></i>
      </button>

      <div class="carousel-items">
        <div *ngFor="let product of recentlyViewedProducts" class="carousel-item">
          <a [routerLink]="['/product', product.id]" class="product-card">
            <!-- Product Image -->
            <div class="product-image-wrapper">
              <img 
                [src]="product.image" 
                [alt]="product.name"
                class="product-image"
                onerror="this.src='assets/images/placeholder.jpg'"
              />
              <div class="product-overlay">
                <span class="view-btn">View Product</span>
              </div>
            </div>

            <!-- Product Info -->
            <div class="product-info">
              <h3 class="product-name">{{ product.name | slice:0:40 }}{{ product.name.length > 40 ? '...' : '' }}</h3>

              <!-- Rating -->
              <div class="rating-section">
                <div class="stars">
                  <i *ngFor="let star of getRatingArray(product.rating)" 
                     class="fas fa-star"
                     [class.filled]="star <= product.rating"
                     [class.empty]="star > product.rating">
                  </i>
                </div>
                <span class="rating-value">{{ product.rating }}</span>
              </div>

              <!-- Price -->
              <div class="price-section">
                <span class="price">₹{{ product.price | number:'0.0-0' }}</span>
                <span *ngIf="product.originalPrice" class="original-price">
                  ₹{{ product.originalPrice | number:'0.0-0' }}
                </span>
              </div>

              <!-- Stock Status -->
              <div class="stock-badge" [class.in-stock]="product.inStock" [class.out-of-stock]="!product.inStock">
                <i class="fas" [class.fa-check-circle]="product.inStock" [class.fa-times-circle]="!product.inStock"></i>
                {{ product.inStock ? 'In Stock' : 'Out of Stock' }}
              </div>
            </div>
          </a>
        </div>
      </div>

      <button class="carousel-nav carousel-nav-next" (click)="scrollCarousel('right')" aria-label="Next">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <!-- Grid View -->
    <div *ngIf="variant === 'grid'" class="grid-wrapper">
      <div *ngFor="let product of recentlyViewedProducts" class="grid-item">
        <a [routerLink]="['/product', product.id]" class="product-card">
          <!-- Product Image -->
          <div class="product-image-wrapper">
            <img 
              [src]="product.image" 
              [alt]="product.name"
              class="product-image"
              onerror="this.src='assets/images/placeholder.jpg'"
            />
            <div class="product-overlay">
              <span class="view-btn">View</span>
            </div>
          </div>

          <!-- Product Info -->
          <div class="product-info">
            <h3 class="product-name">{{ product.name | slice:0:40 }}</h3>

            <!-- Rating -->
            <div class="rating-section">
              <div class="stars">
                <i *ngFor="let star of getRatingArray(product.rating)" 
                   class="fas fa-star"
                   [class.filled]="star <= product.rating">
                </i>
              </div>
              <span class="rating-value">{{ product.rating }}</span>
            </div>

            <!-- Price -->
            <span class="price">₹{{ product.price | number:'0.0-0' }}</span>
          </div>
        </a>
      </div>
    </div>
  </div>
</section>
